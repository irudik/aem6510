---
title: "Lecture 8"
subtitle: "Theory of applied welfare analysis"
author: Ivan Rudik
date: AEM 6510
output:
  xaringan::moon_reader:
    css: ['default', 'metropolis', 'metropolis-fonts', 'my-css.css']
    # self_contained: true
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'


---
exclude: true
```{r setup}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
  tidyverse, tidylog, xaringanExtra, rlang, patchwork
)
options(htmltools.dir.version = FALSE)
knitr::opts_hooks$set(fig.callout = function(options) {
  if (options$fig.callout) {
    options$echo <- FALSE
  }
knitr::opts_chunk$set(echo = TRUE, fig.align="center")
  options
})
```
```{r xaringanExtra, echo = FALSE}
xaringanExtra::use_xaringan_extra(c("tile_view", "panelset", "webcam"))

```
```{r echo=FALSE}
xaringanExtra::style_panelset(panel_tab_color_active = "red")
```

---

# Roadmap

- Review welfare theory
- Understand how the theory can be used to measure changes in welfare from changes in prices
- Understand different kinds of welfare measures, and when to use them

---

# Establishing value

How do we establish monetary value?

We need at minimum two things:

--

A defined baseline state and an ending state (i.e. a change)

--

Measures of a person's:

- .hi-blue[Willingness to pay] to secure the ending state, or
- .hi-red[willingness to accept] to forgo the ending state

--

WTP and WTA are income-equivalents that link the starting and ending states to preferences

---

# How to think about it

Suppose there is a price decrease for a private good

--

A lower price widens the range of consumption outcomes (income effect) and potentially increases well-being

--

The starting state is the initial price

--

The ending state is the new price

--

WTP is how much the person is willing to give up to have the new price

--

WTA is how much the person needs to be given in lieu of the price decrease

---

# WTP and WTA

WTP and WTA are nice because they translate preferences into money equivalents

--

i.e. substitutability matters

--

- If there's a lot of substitutes for the good, the price decrease isn't that valuable
- If there's few substitutes, the price decrease may be very valuable

---

# The general model

Our goal is to use observed behavior (data) to tell us the structure of preferences needed to calculate welfare measures

--

We first need a model that gives rise to observed behavior

--

Let's start with a generalization of our consumer model

---

# The general model

Utility is $U(x,z,q)$
--

- $x$ is a vector of private goods
--

- $z$ is the numeraire with price = $1
--

- $q$ is a vector of environmental goods

--

$q$ can be a bunch of stuff, here we assume it's a good $(U_q > 0)$:
--

- Recreation
--

- Health impacts from clean air
--

- Ecosystem services
--

- etc

---

# The general model

The consumer maximizes utility given some .hi[fixed] level of $q$, vector of market prices $p = \{p_1,...,p_J\}$, and income $y$:
$$\max_{z,x_1,\dots,x_J} U(x,z,q) + \lambda[y - z - \sum_{i=1}^J p_i x_i]$$

--

This gives us the following FOCs:
$$U_{x_j} = \lambda p_j\,\,\,\,\, j = 1,\dots, J$$
and
$$U_z = \lambda$$

---

# The general model

With the FOCs we can solve for the .hi[*ordinary*] demand functions $x_j(p,y,q)$, the Lagrange multiplier $\lambda(p,y,q)$, and $z$<sup>1</sup>

.footnote[
<sup>1</sup>Ordinary demand functions are the regular ones you've seen so far.
]

--

Note we can directly estimate ordinary demand functions since they depend on observables $p, y, q$

---

# The general model

If we substitute $x_j$ into $U$ we get the .hi-blue[indirect utility function] $V(p,y,q)$
- $V(p,y,q)$ tells us the maximized level of utility given prices, income, and environmental quality

--

Note that $\lambda$ can be interpreted as the marginal utility of income

---

# The general model

We can also represent the consumer's behavior by the dual expenditure minimization problem:<sup>1</sup>

.footnote[
<sup>1</sup>In economics, by *dual* we mean expenditure min and utility max solutions are the same.
]

$$\min_{x,z} p\cdot x + z + \mu[\bar{u} - U(x,z,q)]$$
where $\bar{u}$ is a reference level of utility

--

We are minimizing costs subject to keeping utility constant at some arbitrary level

--

Next, get the FOCs

---

# The general model

\begin{align}
  U_{x_j} &= p_j/\mu \\
  U_z &= 1/\mu \\
  U(x,z,q) &= \bar{u}
\end{align}

--

These FOCs allow us to derive .hi-blue[compensated demand functions] $h_j(p, \bar{u}, q)$

--

Note that these are .hi-red[not] directly estimable because we do not observe $\bar{u}$

--

These are also .hi[not the same as the ordinary demand functions]

--

If we substitute the $h_j's$ into the minimization problem we get the expenditure function $E(p,\bar{u},q)$ which is the minimum income required to achieve $\bar{u}$

---

# Duality

The utility max and cost min problems are linked and critical in applied welfare analysis

--

Suppose $u^0$ is the utility level obtained in the utility max problem

--

This gives us that $E(p,u^0,q)$ is the required expenditure

--

And by construction, $y = E(p,u^0,q)$

--

This links the solutions to utility max and cost min at the observed point of consumption by:
$$x_j(p,E(p,u^0,q),q) \equiv h_j(p,u^0,q) \,\,\,\,\, \forall j$$

---

# Duality

$$x_j(p,E(p,u^0,q),q) \equiv h_j(p,u^0,q) \,\,\,\,\, \forall j$$

--

We can now determine the price responses for both kinds of demand functions by differentiating both sides with respect to $p_j$:

--

\begin{align}
  {\partial x_j \over \partial p_j} &= {\partial h_j \over \partial p_j} - {\partial x_j \over \partial y}\times {\partial E_j \over p_j} \\
  &= {\partial h_j \over \partial p_j} - {\partial x_j \over \partial y}\times x_j
\end{align}

--

The second equality comes from Shephard's Lemma: $h_j = {\partial E_j \over \partial p_j}$ (envelope theorem) and the fact that $x_j(p,E(p,u^0,q),q) \equiv h_j(p,u^0,q)$

---

# Ordinary and compensated demand

$${\partial x_j \over \partial p_j}  ={\partial h_j \over \partial p_j} - {\partial x_j \over \partial y}\times x_j$$

What does this result show us?

--

- The difference between compensated $(h)$ and ordinary $(x)$ demand is an .hi-blue[income gradient]
  - If there's no income effect ${\partial x_j \over \partial y}$, then they are equivalent

---

# Ordinary and compensated demand

$${\partial x_j \over \partial p_j}  ={\partial h_j \over \partial p_j} - {\partial x_j \over \partial y}\times x_j$$

What does this result show us?

--

- By definition, utility is held constant for movements in price along the .hi[*compensated*] demand curve, but not the ordinary demand curve
  - Moving along the ordinary demand curve confounds the pure price effect, and an implicit income effect (i.e. the substitution and income effects)
  
--

This is important to understand the types of welfare measures we will be using

---

class: inverse, center, middle
name: base_model

# Price change welfare measures

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>


---

# Price change welfare measures

Suppose there is a change in the price of a private good and we want to know how it affects a person or group's well-being

--

e.g. how does subsidized tuition affect low income households?

--

There are two concepts we can use to measure this effect, which just differ in reference point

---

# Compensating variation

The first concept is .hi-blue[compensating variation] (CV)

--

> Given a price decrease (increase), the CV is the amount of money that would need to be taken from (given to) a person to restore the original utility level.

CV uses the .hi-red[pre-change] level of utility as a reference point

--

CV is the income offset that gives you the pre-change utility back following the price change

---

# Compensating variation

Given a change in price from $p^0 \text{ to } p^1 < p^0$ the CV is:
$$V(p^0,y,q) = V(p^1,y-CV,q)$$
where $V$ is the indirect (maximized) utility function

--

LHS is maximized utility at the baseline price, RHS is maximized utility at the new price taking into account the behavioral change

--

CV is the adjustment to the post-change maximized utility's income level that makes it equal to the pre-change utility

--

Here $CV > 0$ since we are looking at a price decrease

---

# Compensating variation

CV can also be interpreted as WTP or WTA measures

--

CV is the maximum someone is willing to pay to have a lower price
- Anything less provides a utility improvement

--

CV is the minimum someone is willing to accept to have a higher price
- Anything more provides a utility improvement

---

# Equivalent variation

The second concept is .hi-blue[equivalent variation] (EV)

> For a price decrease (increase) that provides a higher (lower) utility level, the EV is the payment (reduction) that moves the person to the new utility level, without the price change

EV uses the post-change level of utility as the reference, it's the income change that puts them at the post-change level of utility without the price change occuring

---

# Equivalent variation

Given a change in price from $p^0 \text{ to } p^1 < p^0$ the EV is:
$$V(p^1,y,q) = V(p^0,y+EV,q)$$
--

LHS is maximized utility at the baseline (changed) price, RHS is maximized utility at the old price but with an income adjustment to keep utility equal

--

Here $EV > 0$ since we are looking at a price decrease

---

# Equivalent variation

EV can also be interpreted as WTP or WTA measures

--

EV is the minimum someone is willing to accept to forgo a price decrease
- Anything more provides a utility improvement

--

EV is the maximum someone is willing to pay to prevent a price increase
- Anything less provides a utility improvement

---

# WTP, WTA, CV, EV

You can start to see that WTP, WTA, CV, and EV are all intertwined (but possibly in confusing ways thus far)

--

Our goal in applied welfare economics is to estimate the components of preferences that we need to calculate CV or EV

--

Once we have CV or EV we have defensible measures for a consumer's value of an exogenous change in some variable

---

# Two additional formulations

Before we continue, let's write down two additional expressions for CV and EV that will help us operationalize our theory:
\begin{align}
  CV &= E(p^0,u^0,q) - E(p^1,u^0,q) \\
    &= y - E(p^1, u^0,q)
\end{align}

\begin{align}
  EV &= E(p^0,u^1,q) - E(p^1,u^1,q) \\
    &= E(p^0,u^1,q) - y
\end{align}

Where the second set of equalities come from the duality of the two problems: $E(\cdot)$ gives the expenditure needs to achieve income $y$ in the utility maximization problem

---

# From expenditure to demand

Now, by the fundamental theorem of calculus we have:
\begin{align}
  CV = E(p^0,u^0,q) - E(p^1,u^0,q) = \int_{p^1_j}^{p^0_j}{\partial E(p, p_{-j},u,q) \over \partial p_j} dp_j  \\
  EV =  E(p^0,u^1,q) - E(p^1,u^1,q) = \int_{p^1_j}^{p^0_j}{\partial E(p, p_{-j},u,q) \over \partial p_j} dp_j 
\end{align}
where $p_{-j}$ is the set of prices without $p_j$

---

# CV and EV as compensated demand

Remember that we found:
$$h_j(p,u,q) = {\partial E(p,u,q) \over \partial p_j}, \,\,\,\, j=1,\dots,J$$
using this we can re-write our CV and EV expressions as integrals

\begin{align}
  CV = E(p^0,u^0,q) - E(p^1,u^0,q) =  \int_{p^1_j}^{p^0_j} h_j(p_j, p_{-j},u^0,q)dp_j  \\
  EV =  E(p^0,u^1,q) - E(p^1,u^1,q) = \int_{p^1_j}^{p^0_j} h_j(p_j, p_{-j},u^1,q)dp_j
\end{align}

--

What does this say about how we interpret CV and EV?

---

# Value is area under the curve

\begin{align}
  CV = E(p^0,u^0,q) - E(p^1,u^0,q) =  \int_{p^1_j}^{p^0_j} h_j(p_j, p_{-j},u^0,q)dp_j  \\
  EV =  E(p^0,u^1,q) - E(p^1,u^1,q) = \int_{p^1_j}^{p^0_j} h_j(p_j, p_{-j},u^1,q)dp_j
\end{align}

.hi-red[Key point:] CV and EV are the area under the appropriate compensated demand curve, between two price levels

--

This is pretty straightforward, we know how to take integrals!

--

.hi-red[One problem:] we usually estimate .hi[*ordinary*] demand curves because we don't observe $u^0,u^1$, we will get to this in a bit

---

# WTP, WTA, CV, EV two ways

Let's look at how we can see WTP, WTA, CV, and EV graphically

--

We will be looking in two different spaces:
--

1. Utility
3. Demand

--

The book shows the intuition in indirect utility space if you're interested (Fig 14.1 Panel B)

---

# CV and EV in utility space

```{r utility_space, echo = FALSE, fig.show = 'hide', warning = F}
ic1 <- function(x) 25/x
ic2 <- function(x) 15/x
budget1 <- function(x) 10 - x
budget2 <- function(x) 10 - 1.7*x
budget_cv <- function(x) 7.65 - x
budget_ev <- function(x) 12.89 - 1.7*x
ggplot() +
  annotate("segment", x = 4, xend = 4, y = 10.1, yend = 12.8,
           linetype = "solid", size = 1, color = "#000000") +
  annotate("segment", x = 4.5, xend = 4.5, y = 7.75, yend = 9.9,
           linetype = "solid", size = 1, color = "#000000") +
  annotate("text", size = 6, label = "EV", x = 4.65, y = 11.3, color = "#000000") +
  annotate("text", size = 6, label = "CV", x = 5.1, y = 8.9, color = "#000000") +
  annotate("segment", x = 0, xend = 15, y = 10, yend = 10,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 15, y = 7.65, yend = 7.65,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 15, y = 12.89, yend = 12.89,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 3.5, xend = 3.5, y = 0, yend = 4,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 2.75, xend = 2.75, y = 0, yend = 5.2,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 5, xend = 5, y = 0, yend = 5,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 4, xend = 4, y = 0, yend = 6,
           linetype = "dotted", size = 1, color = "grey55") +
  stat_function(fun = ic1, color = "#638ccc", size = 1.0) +
  stat_function(fun = ic2, color = "#ca5670", size = 1.0) +
  stat_function(fun = budget1, color = "#638ccc", size = 1.0) +
  stat_function(fun = budget2, color = "#ca5670", size = 1.0) +
  stat_function(fun = budget_cv, color = "#638ccc", size = 1.0, linetype = "longdash") +
  stat_function(fun = budget_ev, color = "#ca5670", size = 1.0, linetype = "longdash") +
  annotate("text", size = 6, label = expression(U^0), x = 0.5, y = 14.25, color = "#ca5670") +
  annotate("text", size = 6, label = expression(U^1), x = 2.5, y = 14.25, color = "#638ccc") +
  annotate("text", size = 6, label = expression(E(p^0,u^1,q)), x = 9, y = 13.5, color = "black") +
  annotate("text", size = 6, label = expression(E(p^0,u^0,q)), x = 9, y = 10.5, color = "black") +
  annotate("text", size = 6, label = expression(E(p^1,u^1,q)), x = 13, y = 10.5, color = "black") +
  annotate("text", size = 6, label = expression(E(p^1,u^0,q)), x = 9, y = 8.2, color = "black") +
  annotate("text", size = 6, label = expression(p^1), x = 10.5, y = 0.5, color = "#638ccc") +
  annotate("text", size = 6, label = expression(p^0), x = 5, y = 0.5, color = "#ca5670") +
  annotate("text", size = 6, label = expression(tilde(p)^1), x = 0.5, y = 6, color = "#638ccc") +
  annotate("text", size = 6, label = expression(tilde(p)^0), x = 0.5, y = 11.2, color = "#ca5670") +
  theme_minimal() +
  theme(
    legend.position = "none",
    title = element_text(size = 24),
    axis.text.x = element_text(size = 16, color = "#000000"), axis.text.y = element_text(size = 16, color = "#000000"),
    axis.title.x = element_text(size = 16, color = "#000000"), axis.title.y = element_text(size = 16, color = "#000000"),
    panel.grid.minor.x = element_blank(), panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(), panel.grid.major.x = element_blank(),
    panel.background = element_rect(fill = "#eeeeee",colour = NA),
    plot.background = element_rect(fill = "#eeeeee",colour = NA),
    axis.line = element_line(colour = "black")
  ) +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 15),
                     breaks = c(2.75, 3.5, 4, 5), labels = expression(x[0], c, d, x[1])) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 15),
                     breaks = 10, labels = expression(y[0])) +
  labs(x = "X",
       y = "Income / Numeraire good",
       title = "Utility space")
  
```

.pull-left[

The red solid budget line labeled $p^0$ is the budget constraint under price $p^0$

The blue solid budget line  labeled $p^1$ is the budget constraint under price $p^1$

$p_1$ kicks out the budget constraint because $p_1 < p_0$

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("utility_space", "png")`)

]

---

# CV and EV in utility space

.pull-left[

The consumer chooses consumption levels $x^0$ and $x_1$ to reach the highest indifference curves $u^0$ (red) and $u^1$ (blue)

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("utility_space", "png")`)

]

---

# CV and EV in utility space

.pull-left[

CV is given by the expenditure needed to reach $u^0$ given the new price

You can compute it by constructing a hypothetical budget line $\tilde{p}^1$ (blue dashed) from price $p^1$ but with reduced income so the consumer can only reach $u^0$

This change in income is CV

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("utility_space", "png")`)

]


---

# CV and EV in utility space

.pull-left[

EV is given by the income needed to reach $u^1$ given the old price

You can compute it by constructing a hypothetical budget line $\tilde{p}^0$ (red dashed) from price $p^0$ but with increased income so the consumer can reach $u^1$

This change in income is EV

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("utility_space", "png")`)

]


---

# CV and EV in demand space

```{r demand_space, echo = FALSE, fig.show = 'hide', warning = F}
ord_demand <- function(x) 3 - x/3
comp_demand_1 <- function(x) 5 - x
comp_demand_0 <- function(x) 4 - x

intersections_1 <- tibble(x = c(0, 2, 2, 3, 3, 3, 1, 1, 0),
                        y = c(2, 3, 0, 4, 2, 0, 0, 4, 4))
ggplot() +
  annotate("segment", x = 0, xend = 5, y = 2, yend = 2,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 5, y = 2.5, yend = 2.5,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 3, xend = 3, y = 0, yend = 2,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 1.5, xend = 1.5, y = 0, yend = 2.5,
           linetype = "dotted", size = 1, color = "grey55") +
  stat_function(fun = comp_demand_1, color = "#638ccc", size = 1.5) +
  stat_function(fun = comp_demand_0, color = "#ca5670", size = 1.5) +
  stat_function(fun = ord_demand, color = "darkslateblue", size = 1.5) +
  annotate("text", size = 6, label = expression(x(p,y,q)), x = 4.25, y = 1.85) +
  annotate("text", size = 6, label = expression(h(p,u^1,q)), x = 4.5, y = 1.07) +
  annotate("text", size = 6, label = expression(h(p,u^0,q)), x = 2.5, y = 1) +
  annotate("text", size = 6, label = "a", x = 1.55, y = 2.65) +
  annotate("text", size = 6, label = "d", x = 2.55, y = 2.65) +
  annotate("text", size = 6, label = "b", x = 3.05, y = 2.15) +
  annotate("text", size = 6, label = "c", x = 2, y = 2.15) +
  theme_minimal()  +
  theme(
    legend.position = "none",
    title = element_text(size = 24),
    axis.text.x = element_text(size = 16, color = "#000000"), axis.text.y = element_text(size = 16, color = "#000000"),
    axis.title.x = element_text(size = 16, color = "#000000"), axis.title.y = element_text(size = 16, color = "#000000"),
    panel.grid.minor.x = element_blank(), panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(), panel.grid.major.x = element_blank(),
    panel.background = element_rect(fill = "#eeeeee",colour = NA),
    plot.background = element_rect(fill = "#eeeeee",colour = NA),
    axis.line = element_line(colour = "black")
  ) +
  labs(x = "X",
       y = "Price",
       title = "Demand space") +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 5),
                     breaks = c(1.5, 3), labels = expression(x[0], x[1])) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 5),
                     breaks = c(2, 2.5), labels = expression(p^1, p^0))
  
```

.pull-left[

The price change traces out the ordinary demand curve (dark blue):

We are holding income $y$ and environmental quality $q$ fixed, so changes in price move us along $x(p,y,q)$

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("demand_space", "png")`)

]


---

# CV and EV in demand space


.pull-left[

Utility is not held constant so we are moving across different compensated demand curves (red to light blue)

What traces out the compensated demand curves?

Changes in *.hi[budget constraints]*

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("demand_space", "png")`)

]

---

# CV and EV in demand space


.pull-left[

From the utility space example: we conceptualized moving from $p^0$ to $\tilde{p}^1$, a change in the budget constraint (price and also income) that kept utility constant, in order to recover CV

This change traces out $h(p,u^0,q)$

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("demand_space", "png")`)

]

---

# CV and EV in demand space


.pull-left[

From the utility space example: we conceptualized moving from $p^1$ to $\tilde{p}^0$, a change in the budget constraint (price and also income) that kept utility constant, in order to recover EV

This change traces out $h(p,u^1,q)$

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("demand_space", "png")`)

]


---

# CV and EV in demand space


.pull-left[

We never observe $\tilde{p}^0$ or $\tilde{p}^1$, they're just hypothetical

This illustrates how we do not directly observe compensated demand curves even though they are how we compute CV and EV

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("demand_space", "png")`)

]

---

# CV and EV in demand space



```{r demand_space_cv, echo = FALSE, fig.show = 'hide', warning = F}
ord_demand <- function(x) 3 - x/3
comp_demand_1 <- function(x) 5 - x
comp_demand_0 <- function(x) 4 - x


polys_dwl <- tibble(x = c(0, 0, 1.5, 2),
                     y = c(2, 2.5, 2.5, 2))
ggplot() +
  geom_polygon(data = polys_dwl, aes(x = x, y = y), fill = "red", alpha = 0.2) +
  annotate("segment", x = 0, xend = 5, y = 2, yend = 2,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 5, y = 2.5, yend = 2.5,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 3, xend = 3, y = 0, yend = 2,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 1.5, xend = 1.5, y = 0, yend = 2.5,
           linetype = "dotted", size = 1, color = "grey55") +
  stat_function(fun = comp_demand_1, color = "#638ccc", size = 1.5) +
  stat_function(fun = comp_demand_0, color = "#ca5670", size = 1.5) +
  stat_function(fun = ord_demand, color = "darkslateblue", size = 1.5) +
  annotate("text", size = 6, label = expression(x(p,y,q)), x = 4.25, y = 1.85) +
  annotate("text", size = 6, label = expression(h(p,u^1,q)), x = 4.5, y = 1.07) +
  annotate("text", size = 6, label = expression(h(p,u^0,q)), x = 2.5, y = 1) +
  annotate("text", size = 6, label = "a", x = 1.55, y = 2.65) +
  annotate("text", size = 6, label = "d", x = 2.55, y = 2.65) +
  annotate("text", size = 6, label = "b", x = 3.05, y = 2.15) +
  annotate("text", size = 6, label = "c", x = 2, y = 2.15) +
  theme_minimal()  +
  theme(
    legend.position = "none",
    title = element_text(size = 24),
    axis.text.x = element_text(size = 16, color = "#000000"), axis.text.y = element_text(size = 16, color = "#000000"),
    axis.title.x = element_text(size = 16, color = "#000000"), axis.title.y = element_text(size = 16, color = "#000000"),
    panel.grid.minor.x = element_blank(), panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(), panel.grid.major.x = element_blank(),
    panel.background = element_rect(fill = "#eeeeee",colour = NA),
    plot.background = element_rect(fill = "#eeeeee",colour = NA),
    axis.line = element_line(colour = "black")
  ) +
  labs(x = "X",
       y = "Price",
       title = "Demand space") +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 5),
                     breaks = c(1.5, 3), labels = expression(x[0], x[1])) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 5),
                     breaks = c(2, 2.5), labels = expression(p^1, p^0))
  
```

.pull-left[

What is CV and EV on the graph?

CV is $(p^0, a, c, p^1)$

It is the area under the original compensated demand curve

And note that area under is flipped because price is on the y axis for the inverse demand curves we plot

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("demand_space_cv", "png")`)

]


---

# CV and EV in demand space



```{r demand_space_ev, echo = FALSE, fig.show = 'hide', warning = F}
ord_demand <- function(x) 3 - x/3
comp_demand_1 <- function(x) 5 - x
comp_demand_0 <- function(x) 4 - x


polys_dwl <- tibble(x = c(0, 0, 2.5, 3),
                     y = c(2, 2.5, 2.5, 2))
ggplot() +
  geom_polygon(data = polys_dwl, aes(x = x, y = y), fill = "blue", alpha = 0.2) +
  annotate("segment", x = 0, xend = 5, y = 2, yend = 2,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 5, y = 2.5, yend = 2.5,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 3, xend = 3, y = 0, yend = 2,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 1.5, xend = 1.5, y = 0, yend = 2.5,
           linetype = "dotted", size = 1, color = "grey55") +
  stat_function(fun = comp_demand_1, color = "#638ccc", size = 1.5) +
  stat_function(fun = comp_demand_0, color = "#ca5670", size = 1.5) +
  stat_function(fun = ord_demand, color = "darkslateblue", size = 1.5) +
  annotate("text", size = 6, label = expression(x(p,y,q)), x = 4.25, y = 1.85) +
  annotate("text", size = 6, label = expression(h(p,u^1,q)), x = 4.5, y = 1.07) +
  annotate("text", size = 6, label = expression(h(p,u^0,q)), x = 2.5, y = 1) +
  annotate("text", size = 6, label = "a", x = 1.55, y = 2.65) +
  annotate("text", size = 6, label = "d", x = 2.55, y = 2.65) +
  annotate("text", size = 6, label = "b", x = 3.05, y = 2.15) +
  annotate("text", size = 6, label = "c", x = 2, y = 2.15) +
  theme_minimal()  +
  theme(
    legend.position = "none",
    title = element_text(size = 24),
    axis.text.x = element_text(size = 16, color = "#000000"), axis.text.y = element_text(size = 16, color = "#000000"),
    axis.title.x = element_text(size = 16, color = "#000000"), axis.title.y = element_text(size = 16, color = "#000000"),
    panel.grid.minor.x = element_blank(), panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(), panel.grid.major.x = element_blank(),
    panel.background = element_rect(fill = "#eeeeee",colour = NA),
    plot.background = element_rect(fill = "#eeeeee",colour = NA),
    axis.line = element_line(colour = "black")
  ) +
  labs(x = "X",
       y = "Price",
       title = "Demand space") +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 5),
                     breaks = c(1.5, 3), labels = expression(x[0], x[1])) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 5),
                     breaks = c(2, 2.5), labels = expression(p^1, p^0))
  
```

.pull-left[

What is CV and EV on the graph?

EV is $(p^0, d, b, p^1)$

It is the area under the new compensated demand curve

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("demand_space_ev", "png")`)

]


---

# Toward computing CV and EV

We saw that we can compute CV and EV using compensated demand curves, so we can link these valuation concepts to behaviorial function for the good

--

Our problem again is that we do not observe compensated demand curves, but ordinary demand curves

--

Often times economists will use .hi-blue[consumer surplus (CS)] in place of CV or EV

---

# Consumer surplus

CS is effectively the ordinary demand version of EV and CV

--

CS is given by:
$$CS = \int_{p^0_j}^{p^1_j}x_j(p,y,q)dp_j$$

--

Since this is based on ordinary demand, we can compute it easily if we have an estimate of consumer demand


---

# CS in demand space

```{r demand_space_cs, echo = FALSE, fig.show = 'hide', warning = F}
ord_demand <- function(x) 3 - x/3
comp_demand_1 <- function(x) 5 - x
comp_demand_0 <- function(x) 4 - x


polys_dwl <- tibble(x = c(0, 0, 1.5, 3),
                     y = c(2, 2.5, 2.5, 2))
ggplot() +
  geom_polygon(data = polys_dwl, aes(x = x, y = y), fill = "green", alpha = 0.2) +
  annotate("segment", x = 0, xend = 5, y = 2, yend = 2,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 5, y = 2.5, yend = 2.5,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 3, xend = 3, y = 0, yend = 2,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 1.5, xend = 1.5, y = 0, yend = 2.5,
           linetype = "dotted", size = 1, color = "grey55") +
  stat_function(fun = comp_demand_1, color = "#638ccc", size = 1.5) +
  stat_function(fun = comp_demand_0, color = "#ca5670", size = 1.5) +
  stat_function(fun = ord_demand, color = "darkslateblue", size = 1.5) +
  annotate("text", size = 6, label = expression(x(p,y,q)), x = 4.25, y = 1.85) +
  annotate("text", size = 6, label = expression(h(p,u^1,q)), x = 4.5, y = 1.07) +
  annotate("text", size = 6, label = expression(h(p,u^0,q)), x = 2.5, y = 1) +
  annotate("text", size = 6, label = "a", x = 1.55, y = 2.65) +
  annotate("text", size = 6, label = "d", x = 2.55, y = 2.65) +
  annotate("text", size = 6, label = "b", x = 3.05, y = 2.15) +
  annotate("text", size = 6, label = "c", x = 2, y = 2.15) +
  theme_minimal()  +
  theme(
    legend.position = "none",
    title = element_text(size = 24),
    axis.text.x = element_text(size = 16, color = "#000000"), axis.text.y = element_text(size = 16, color = "#000000"),
    axis.title.x = element_text(size = 16, color = "#000000"), axis.title.y = element_text(size = 16, color = "#000000"),
    panel.grid.minor.x = element_blank(), panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(), panel.grid.major.x = element_blank(),
    panel.background = element_rect(fill = "#eeeeee",colour = NA),
    plot.background = element_rect(fill = "#eeeeee",colour = NA),
    axis.line = element_line(colour = "black")
  ) +
  labs(x = "X",
       y = "Price",
       title = "Demand space") +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 5),
                     breaks = c(1.5, 3), labels = expression(x[0], x[1])) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 5),
                     breaks = c(2, 2.5), labels = expression(p^1, p^0))
  
```

.pull-left[

What is CS on the graph

CS is $(p^0, a, b, p^1)$

It is the area under the ordinary demand curve

What is this measuring?

How does it relate to WTP and WTA?

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("demand_space_cs", "png")`)

]

---

# What is CS

In general CS has no WTP/WTA interpretation since utility is not held fixed for movements along an ordinary demand curve (look at last figure, we jumped compensated demand curves!)

--

Let's see if CS is something else that can be useful

---

# Roy's identity

First we need to derive a central result in economics, .hi-blue[Roy's Identity]
$$x_j = -{\partial V / \partial p_j \over \partial V / \partial y}$$

Roy's identity relates ordinary demand to the indirect utility function $V(p,y)$

---

# Roy's identity

The derivation is pretty simple


Plug the expenditure function into $V$ at $\bar{u}$:

$$V(p,e(p,\bar{u})) = \bar{u}$$

--

Differentiate both sides with respect to $p_j$:
$${\partial V \over \partial p_j} +  {\partial V \over \partial y}{\partial e \over \partial p_j} = 0$$

and recall that ${\partial e \over \partial p_j} = h_j(p,\bar{u}) = x_j(p,e(p,\bar{u}))$

---

# Roy's identity

We then get:

$${\partial V \over \partial p_j} +  {\partial V \over \partial y}x_j = 0$$
and finally
$$x_j = -{\partial V / \partial p_j \over \partial V / \partial y}$$

It's kind of like an MRS, the demand for good $x_i$ is the income increase required to compensate for a change in the price of good $i$

---

# What is CS?

Now plug this expression for $x_i$ into our definition of CS to get:
$$CS = \int_{p^0_j}^{p^1_j}x_j(p,y,q)dp_j = \int_{p^0_j}^{p^1_j}-{V_{p_j}(p,y,q) \over V_{y}(p,y,q)} dp_j = \int_{p^0_j}^{p^1_j}-{V_{p_j}(p,y,q) \over \lambda(p,y,q)} dp_j$$
where $V_{p_j}(p,y,q) = \partial v / \partial p_j$ and $V_{y}(p,y,q) = \partial v / \partial y$, and $\lambda$ is the marginal utility of income

--

Now lets look at our first result

--

Assume that $\lambda(p,y,q)$ is not a function of $p_j$: $\partial \lambda / \partial p_j = 0$

---

# What is CS?

We can re-write CS as:
$$CS = {1 \over \lambda(p,y,q)}\int_{p^0_j}^{p^1_j}-{V_{p_j}(p,y,q) } dp_j = [V(p^0,y,q) - V(p^1,y,q)]{1 \over \lambda(p,y,q)}$$

If the marginal utility of income is constant with respect to price, .hi-blue[CS is a money-metric reflection of the change in utility!]

--

- Change in utility: $V_{p_j}(p^0,y,q) - V_{p_j}(p^1,y,q)$
- Translated into dollar terms by: ${1 \over \lambda(p,y,q)}$

--

CS is the change in money implied by a change in utility when $\partial \lambda / \partial p_j = 0$

---

# What is CS?

$\partial \lambda / \partial p_j = 0$ is generally .hi-red[not] going to be true

--

Pg 399-400 in the book show how assuming $\partial \lambda / \partial p_j = 0$ implies that the .hi-blue[income elasticity of demand] must be equal for all goods whose prices may change in the analysis:
$${\partial x_j \over \partial y}{y \over x_j} = {\partial x_k \over \partial y}{y \over x_k} \,\,\, \forall j,k$$

---

# CS as an approximation

CS doesn't generally recover the money-equivalent change in utility

--

However it is much easier to estimate than anything based off of the compensated demand curve

--

One thing we want to find out: .hi-blue[how big is the error if we use CS in place of CV or EV?]

--

First thing we can observe: for a .hi[normal good]: $CV \leq CS \leq EV$

--

Willig (1976) shows that $CS$ is a first-order approximation if the income elasticity is small or the change in CS is small relative to the budget

---

# CS and measurement

Hausman (1981) made approximations unnecessary

--

He showed that under certain .hi[integratibility conditions], ordinary demand curves contain all the information we need

--

To see this let's first look at two identities in consumer economics

1. From before: the observed demand level solves the utility maximization .hi[and] expenditure minimization problems
2. $\bar{u} = V(p,E(p,\bar{u},q),q)$, the indirect utility given an income $y$ equal to the expenditure to achieve $\bar{u}$ is equal to $\bar{u}$

---

# CS and measurement

Differentiate $\bar{u} = V(p,E(p,\bar{u},q),q)$ with respect to $p_j$:
$${\partial V \over \partial p_j} + {\partial V \over \partial y}{\partial E \over \partial p_j} = 0$$

which gives us that:
$${\partial E(p,\bar{u},q) \over \partial p_j} = {\partial V \over \partial p_j}\bigg/{\partial V \over \partial y} = x_j(p,y,q)$$
where the second equality is .hi-blue[Roy's identity]

--

This relates income (equal to expenditures at the optimum) and price

---

# CS and measurement

$${\partial E(p,\bar{u},q) \over \partial p_j} = {\partial y(p) \over \partial p_j} = x_j(p,y,q)$$

Suppose we:
1. Parameterized $x_j$ with some functional form
2. Estimated the parameters of $x_j$ using real world data

We can then solve
${\partial y(p) \over \partial p_j} = x_j(p,y,q)$
for $y$ to get: $y[p_j,k(p_{-j},q)]$

$k$ is a constant of integration

---

# CS and measurement

If $k(p_{-j},q)$ is held fixed, then $y[p_j,k(p_{-j},q)]$ is a .hi[quasi-expenditure] function

--

This means we can compute welfare measures with it!

--

Since utility is .hi[ordinal] we only care about comparisons, not levels, so we can set $u^0 = k(p_{-j},q)$ so that
$$y[p_j,k(p_{-j},q)] = y[p_j,u^0] = \hat{E}(p_j,u^0)$$

--

We can compute CV for a change in $p_j$ easily using this quasi-expenditure function, but we need to assume prices of other goods and environmental quality are .hi-red[fixed]

---

class: inverse, center, middle
name: base_model

# Quantity change welfare measures

<html><div style='float:left'></div><hr color='#EB811B' size=1px width=796px></html>

---

# Quantity change welfare measures

In environmental economics we are more concerned with .hi-blue[quantity changes] in quasi-fixed environmental goods rather than price changes in private goods

--

How is this analysis different and similar to our analysis of price changes?

--

First let's define CV and EV in terms of .hi[environmental quantity changes]

--

Here we will be thinking about increasing $q$ from $q^0$ to $q^1$

---

# CV and EV: indirect utility

Compensating variation $CV$ is given by:
$$V(p,y,q^0) = V(p,y-CV,q^1)$$
and equivalent variation $EV$ is given by:
$$V(p,y,q^1) = V(p,y+CV,q^0)$$

--

CV is the WTP to have the environmental improvement $q^0 \rightarrow q^1$

EV is the WTA to forgo the environmental improvement $q^0 \rightarrow q^1$

---

# WTP vs WTA with quantity changes

Unlike with price changes the choice of EV or CV matters conceptually

--

One implies the individual has property rights to the improvement (EV),  
and one implies they do not have property rights (CV)

--

This may matter in practice because WTP and WTA can diverge due to budget constraints:<sup>1</sup>
  - You can only pay as much as your budget but you can accept any positive amount

.footnote[
There are also other behavioral reasons, but we won't touch on them here. See Sec 14.4 for details on the budget argument.
]

---

# CV and EV: expenditure function

We can also define CV and EV with the expenditure function:
\begin{align}
  CV =& E(p,u^0,q^0) - E(p,u^0,q^1) \\
    =& y = E(p,u^0,q^1) \\
    \,\,\, \\
  EV =& E(p,u^1,q^0) - E(p,u^1,q^1) \\
    =& E(p,u^1,q^0) - y \\
\end{align}

---

# CV and EV: demand curves

We can also compute quantity change CV and EV with demand curves like we did for price changes

--

Note that since $q$ is fixed from the individual's perspective, we will need to look at .hi[inverse] demand curves (the usual kind on the graphs we draw)

--

The compensated inverse demand is given by:
$$\Pi^q(p,u,q) = - {\partial E(p,u,q) \over \partial q}$$
which is the marginal willingness to pay for $q$: it's the change in income that holds utility constant given a marginal increase in $q$

---

# CV and EV: demand curves

CV and EV are then the area under the MWTP/inverse demand curves:

.pull-left[
\begin{align}
  CV =& \int_{q^0}^{q^1} \pi^q(p,u^0,q) dq \\
    =& \int_{q^0}^{q^1} - {\partial E(p,u^0,q) \over \partial q} dq \\
    =& E(p,u^0,q^0) - E(p,u^0,q^1) 
\end{align}
]


.pull-right[
\begin{align}
  EV =& \int_{q^0}^{q^1} \pi^q(p,u^1,q) dq \\
    =& \int_{q^0}^{q^1} - {\partial E(p,u^1,q) \over \partial q} dq \\
    =& E(p,u^1,q^0) - E(p,u^1,q^1) 
\end{align}
]


---

# CV and EV in utility space

```{r utility_space_q, echo = FALSE, fig.show = 'hide', warning = F}
ic1 <- function(x) 25/x + 2
ic2 <- function(x) 22/x
ggplot() +
  stat_function(fun = ic1, color = "#638ccc", size = 1.0) +
  stat_function(fun = ic2, color = "#ca5670", size = 1.0) +
  annotate("segment", x = 0, xend = 8, y = 5, yend = 5,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 8, y = 2.85, yend = 2.85,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 8, xend = 8, y = 0, yend = 5,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 4.5, y = 7.6, yend = 7.6,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 4.5, xend = 4.5, y = 0, yend = 7.6,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("text", size = 6, label = expression(U^0), x = 1, y = 14.25, color = "#ca5670") +
  annotate("text", size = 6, label = expression(U^1), x = 3, y = 14.25, color = "#638ccc") +
  annotate("text", size = 6, label = "b", x = 8.2, y = 5.4) +
  annotate("text", size = 6, label = "c", x = 8.3, y = 2.35) +
  annotate("text", size = 6, label = "d", x = 4.7, y = 7.8) +
  annotate("text", size = 6, label = "a", x = 4.2, y = 4.75) +
  theme_minimal() +
  theme(
    legend.position = "none",
    title = element_text(size = 24),
    axis.text.x = element_text(size = 16, color = "#000000"), axis.text.y = element_text(size = 16, color = "#000000"),
    axis.title.x = element_text(size = 16, color = "#000000"), axis.title.y = element_text(size = 16, color = "#000000"),
    panel.grid.minor.x = element_blank(), panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(), panel.grid.major.x = element_blank(),
    panel.background = element_rect(fill = "#eeeeee",colour = NA),
    plot.background = element_rect(fill = "#eeeeee",colour = NA),
    axis.line = element_line(colour = "black")
  ) +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 15),
                     breaks = c(4.5, 8), labels = expression(q^0, q^1)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 15),
                     breaks = c(2.85, 5, 7.6), labels = expression(E(p,u^0,q^1), y[0], E(p,u^1,q^0))) +
  labs(x = "q",
       y = "Income / Numeraire good",
       title = "Utility space")
  
```

.pull-left[

Y axis is income/spending on all private goods

X axis is quantity of the environmental good

We start at $a$ where we are at $u^0$ and $q^0$

(Skipping drawing inverse demand curves)



]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("utility_space_q", "png")`)

]

---

# CV and EV in utility space


.pull-left[

When $q^0 \rightarrow q^1$ we move to point $b$ and $u^0 \rightarrow u^1$

Income/expenditures is held constant because .hi[q has no price] so we just move horizontally

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("utility_space_q", "png")`)

]


---

# CV and EV in utility space


.pull-left[

CV is the change in income needed to go from $u^0 \rightarrow u^1$ at $q^1$: $y_0 - E(p,u^0,q^1)$

EV is the change in income needed to go from $u^0 \rightarrow u^1$ at $q^0$: $E(p,u^1,q^0) - y_0$

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("utility_space_q", "png")`)

]


---

# CV and EV in utility space


.pull-left[

Tracing out demand curves is a little trickier here since $q$ has no price

Here's how to think about it:

- Suppose $q$ was traded in a market at some .hi[virtual price] $\pi$
- The person's virtual income to .hi-blue[compensate] them and keep their private good spending to be $y_0$ is: $\tilde{y} = y_0 + \pi \tilde{q}$ 

]

.pull-right[

![virtual prices for q](`r knitr::fig_chunk("utility_space_q", "png")`)

]

---

# CV and EV in utility space


.pull-left[

$$\tilde{y} = y_0 + \pi \tilde{q}$$

Given some income $\tilde{y}$ the consumer "buys" $\tilde{q}$ units such that the budget constraint is tangent to an indifference curve (like usual)

]

.pull-right[

![virtual prices for q](`r knitr::fig_chunk("utility_space_q", "png")`)

]

---

# CV and EV in utility space


```{r utility_space_q_virtual, echo = FALSE, fig.show = 'hide', warning = F}
ic1 <- function(x) 25/x + 2
ic2 <- function(x) 22/x
ggplot() +
  stat_function(fun = ic1, color = "#638ccc", size = 1.0) +
  stat_function(fun = ic2, color = "#ca5670", size = 1.0) +
  annotate("segment", x = 0, xend = 8, y = 5, yend = 5,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 8, y = 2.85, yend = 2.85,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 8, xend = 8, y = 0, yend = 5,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 4.5, y = 7.6, yend = 7.6,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 4.5, xend = 4.5, y = 0, yend = 7.6,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("text", size = 6, label = expression(U^0), x = 1, y = 14.25, color = "#ca5670") +
  annotate("text", size = 6, label = expression(U^1), x = 3, y = 14.25, color = "#638ccc") +
  annotate("text", size = 6, label = expression(pi[1](tilde(y)[1])), x = 8.2, y = 5.4) +
  annotate("text", size = 6, label = expression(pi[2](tilde(y)[2])), x = 8.3, y = 2.35) +
  annotate("text", size = 6, label = expression(pi[3](tilde(y)[3])), x = 4.7, y = 7.8) +
  annotate("text", size = 6, label = expression(pi[0](tilde(y)[0])), x = 4.2, y = 4.75) +
  theme_minimal() +
  theme(
    legend.position = "none",
    title = element_text(size = 24),
    axis.text.x = element_text(size = 16, color = "#000000"), axis.text.y = element_text(size = 16, color = "#000000"),
    axis.title.x = element_text(size = 16, color = "#000000"), axis.title.y = element_text(size = 16, color = "#000000"),
    panel.grid.minor.x = element_blank(), panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(), panel.grid.major.x = element_blank(),
    panel.background = element_rect(fill = "#eeeeee",colour = NA),
    plot.background = element_rect(fill = "#eeeeee",colour = NA),
    axis.line = element_line(colour = "black")
  ) +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 15),
                     breaks = c(4.5, 8), labels = expression(q^0, q^1)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 15),
                     breaks = c(2.85, 5, 7.6), labels = expression(E(p,u^0,q^1), y[0], E(p,u^1,q^0))) +
  labs(x = "q",
       y = "Income / Numeraire good",
       title = "Utility space")
  
```

.pull-left[

Let $\pi_0(\tilde{y}_0), \pi_1(\tilde{y}_1), \pi_2(\tilde{y}_2), \pi_3(\tilde{y}_3)$ be the virtual price/income combinations tangent at points $a, b, c, d$

We can use these to trace out our compensated inverse demand curves by moving along the same indifference curve to different levels of $q$

]

.pull-right[

![virtual prices for q](`r knitr::fig_chunk("utility_space_q_virtual", "png")`)

]


---

# CV and EV in utility space

.pull-left[

The virtual price change along an indifference curve trace out the compensated inverse demands:
  - $\pi_0(\tilde{y}_0)$ and $\pi_2(\tilde{y}_2)$ trace out $\pi^q(p,u^0,q)$
  - $\pi_3(\tilde{y}_3)$ and $\pi_1(\tilde{y}_1)$ trace out $\pi^q(p,u^1,q)$

]

.pull-right[

![virtual prices for q](`r knitr::fig_chunk("utility_space_q_virtual", "png")`)

]

---

# CV and EV in utility space

.pull-left[

The virtual price change from $q^0$ to $q^1$ holding income fixed traces out the ordinary inverse demand curve
  - $\pi_0(\tilde{y}_0)$ and $\pi_1(\tilde{y}_1)$ trace out $\theta^q(p,y,q)$

]

.pull-right[

![virtual prices for q](`r knitr::fig_chunk("utility_space_q_virtual", "png")`)

]


---

# CV and EV in demand space

```{r demand_space_q, echo = FALSE, fig.show = 'hide', warning = F}
ord_demand <- function(x) 3 - x/3
comp_demand_1 <- function(x) 5 - x
comp_demand_0 <- function(x) 4 - x

intersections_1 <- tibble(x = c(0, 2, 2, 3, 3, 3, 1, 1, 0),
                        y = c(2, 3, 0, 4, 2, 0, 0, 4, 4))
ggplot() +
  annotate("segment", x = 0, xend = 5, y = 2, yend = 2,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 1.5, y = 3.5, yend = 3.5,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 3, y = 1, yend = 1,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 0, xend = 1.5, y = 2.5, yend = 2.5,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 3, xend = 3, y = 0, yend = 2,
           linetype = "dotted", size = 1, color = "grey55") +
  annotate("segment", x = 1.5, xend = 1.5, y = 0, yend = 3.5,
           linetype = "dotted", size = 1, color = "grey55") +
  stat_function(fun = comp_demand_1, color = "#638ccc", size = 1.5) +
  stat_function(fun = comp_demand_0, color = "#ca5670", size = 1.5) +
  stat_function(fun = ord_demand, color = "darkslateblue", size = 1.5) +
  annotate("text", size = 6, label = expression(theta^q(p,y,q)), x = 4.25, y = 1.85) +
  annotate("text", size = 6, label = expression(pi^q(p,u^1,q)), x = 4.5, y = 1.07) +
  annotate("text", size = 6, label = expression(pi^q(p,u^0,q)), x = 2, y = 1.5) +
  annotate("text", size = 6, label = "a", x = 1.55, y = 2.65) +
  annotate("text", size = 6, label = "d", x = 1.55, y = 3.65) +
  annotate("text", size = 6, label = "b", x = 3.05, y = 2.15) +
  annotate("text", size = 6, label = "c", x = 3.1, y = 1.15) +
  theme_minimal()  +
  theme(
    legend.position = "none",
    title = element_text(size = 24),
    axis.text.x = element_text(size = 16, color = "#000000"), axis.text.y = element_text(size = 16, color = "#000000"),
    axis.title.x = element_text(size = 16, color = "#000000"), axis.title.y = element_text(size = 16, color = "#000000"),
    panel.grid.minor.x = element_blank(), panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(), panel.grid.major.x = element_blank(),
    panel.background = element_rect(fill = "#eeeeee",colour = NA),
    plot.background = element_rect(fill = "#eeeeee",colour = NA),
    axis.line = element_line(colour = "black")
  ) +
  labs(x = "q",
       y = "Price",
       title = "Demand space") +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 5),
                     breaks = c(1.5, 3), labels = expression(q[0], q[1])) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 5),
                     breaks = c(1, 2, 2.5, 3.5), labels = expression(pi^2, pi^1, pi^0, pi^3))
  
```

.pull-left[

Similar to before (but now with axes flipped since these are inverse demands)

CV is given by the area $q_0,a,c,q_1$

EV is given by the area $q_0,d,b,q_1$

CS is given by the area $q_0,a,b,q_1$
]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("demand_space_q", "png")`)

]


---

# Compensated demand and virtual prices

.pull-left[

Now we have started to get the intuition for why it's called compensated demand

--

We are directly .hi-blue[compensating] the person's income to maintain constant utility

]

.pull-right[

![Tangent line at the optimum has 0 slope](`r knitr::fig_chunk("demand_space_q", "png")`)

]

---

# The fundamental challenge of measurement

Recall with price changes we were able to value them by relating them to (quasi-)expenditures:
$${\partial E(p,\bar{u},q) \over \partial p_j} = {\partial V \over \partial p_j}\bigg/{\partial V \over \partial y} = x_j(p,y,q)$$

--

Here we will have the equivalent outcome:
$${\partial E(p,\bar{u},q) \over \partial q} = {\partial V \over \partial q}\bigg/{\partial V \over \partial y} = \theta^q(p,y,q)$$

--

If we can obtain the ordinary inverse demand curve for $q$ then we can calculate welfare measures!

---

# The fundamental challenge of measurement

What's the problem?

--

$q$ isn't traded in markets

--

We .hi-red[don't] observe an ordinary inverse demand curve because there are no prices-quantity pairs

--

This is the fundamental challenge with measuring changes in the quantity of environmental goods

--

We solve this challenge by studying market goods that capitalize the value of environmental goods
